<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-42SQV5RQNV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-42SQV5RQNV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Become a Tutor - EduGator</title>
    <script>
        // Check localStorage and set data-auth attribute immediately
        (function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            document.documentElement.setAttribute('data-auth', isLoggedIn ? 'in' : 'out');
        })();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }
        nav {
            background-color: #333;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            gap: 2rem;
            height: 70px;
        }
        .nav-left {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex: 1;
            min-height: 38px;
        }
        .logo img {
            height: 30px;
            width: auto;
            display: block;
        }
        .nav-menu {
            list-style: none;
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        .nav-item {
            position: relative;
            display: flex;
            align-items: center;
        }
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }
        .nav-auth-in {
            display: none !important;
        }
        html[data-auth="in"] .nav-auth-in {
            display: flex !important;
        }
        html[data-auth="in"] .nav-auth-out {
            display: none !important;
        }
        html[data-auth="out"] .nav-auth-in {
            display: none !important;
        }
        .inbox-icon img {
            height: 24px;
            width: 24px;
            display: block;
            filter: brightness(0) invert(1);
        }
        .nav-link:hover {
            background-color: #555;
        }
        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #444;
            min-width: 200px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }
        .nav-item:hover .dropdown {
            display: block;
        }
        .dropdown-item {
            display: block;
            color: white;
            text-decoration: none;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #555;
            transition: background-color 0.3s;
        }
        .dropdown-item:hover {
            background-color: #555;
        }
        .dropdown-item:last-child {
            border-bottom: none;
        }
        .page {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        .breadcrumbs {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .breadcrumbs a {
            color: #333;
            text-decoration: none;
            background: #eaeaea;
            padding: 0.4rem 0.7rem;
            border-radius: 0.5rem;
            transition: background 0.2s;
        }
        .breadcrumbs a:hover {
            background: #d9d9d9;
        }
        .form-container {
            background: #fff;
            border-radius: 10px;
            padding: 2.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .form-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .form-header h1 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        .form-header p {
            color: #666;
            font-size: 1rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        .required {
            color: #e63946;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: Arial, sans-serif;
            transition: border-color 0.2s;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2f4ba5;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .form-group small {
            display: block;
            color: #666;
            margin-top: 0.25rem;
            font-size: 0.85rem;
        }
        .file-upload-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .file-upload-label {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #eaeaea;
            color: #333;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        .file-upload-label:hover {
            background-color: #d9d9d9;
        }
        .file-upload-input {
            display: none;
        }
        .file-name {
            color: #666;
            font-size: 0.9rem;
            padding: 0.5rem;
        }
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        .btn {
            flex: 1;
            padding: 0.9rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary {
            background-color: #2f4ba5;
            color: white;
            box-shadow: 0 2px 8px rgba(47, 75, 165, 0.3);
        }
        .btn-primary:hover {
            background-color: #243a85;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(47, 75, 165, 0.4);
        }
        .btn-secondary {
            background-color: #eaeaea;
            color: #333;
        }
        .btn-secondary:hover {
            background-color: #d9d9d9;
        }
        .info-box {
            background-color: #e8eefc;
            border-left: 4px solid #2f4ba5;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 6px;
        }
        .info-box h3 {
            color: #2f4ba5;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .info-box ul {
            margin-left: 1.5rem;
            color: #333;
        }
        .info-box li {
            margin-bottom: 0.25rem;
        }
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        .toast.info {
            background: #2f4ba5;
        }
        .toast.success {
            background: #10b981;
        }
        .toast.error {
            background: #ef4444;
        }
        @media (max-width: 768px) {
            .form-container {
                padding: 1.5rem;
            }
            .form-actions {
                flex-direction: column;
            }
        }
        .demo-banner {
            background-color: #06402B; /* Dark Green */
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="demo-banner">
        SFSU Software Engineering Project CSC 648-848, Fall 2025. For Demonstration Only
    </div>
    <nav>
        <div class="nav-container">
            <div class="nav-left">
                <a href="index.html" class="logo">
                    <img src="public/nav_logo.png" alt="EduGator Logo">
                </a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item">
                    <a href="#" class="nav-link">About</a>
                    <div class="dropdown">
                        <a href="about/about-grady.html" class="dropdown-item">Grady Walworth - Team Lead</a>
                        <a href="about/about-michael.html" class="dropdown-item">Michael Thompson - Github Lead</a>
                        <a href="about/about-tejas.html" class="dropdown-item">Tejas Rajan - Frontend Lead</a>
                        <a href="about/about-kameron.html" class="dropdown-item">Kameron Jacob - Frontend Developer</a>
                        <a href="about/about-chris.html" class="dropdown-item">Chris Chan - Backend Lead</a>
                        <a href="about/about-hardy.html" class="dropdown-item">Hardy Chang - Backend Developer</a>
                    </div>
                </li>
                <li class="nav-item nav-auth-in" id="inbox-placeholder">
                    <a href="inbox.html" class="nav-link inbox-icon">
                      <img src="public/inbox-icon.png" alt="Messages">
                    </a>
                  </li>
                <li class="nav-item nav-auth-in" id="profile-placeholder"><a href="studentDashboard.html" class="nav-link">Profile</a></li>
                <li class="nav-item nav-auth-out"><a href="auth/login.html" class="nav-link">Login</a></li>
            </ul>
        </div>
    </nav>

    <main class="page">
        <div class="breadcrumbs">
            <a href="studentDashboard.html">‚Üê Back to Dashboard</a>
        </div>

        <div class="form-container">
            <div class="form-header">
                <h1>Apply to Become a Tutor</h1>
                <p>Share your expertise and help fellow students succeed!</p>
            </div>

            <div class="info-box">
                <h3>What to expect:</h3>
                <ul>
                    <li>Your application will be reviewed by our team</li>
                    <li>Verification typically takes 2-3 business days</li>
                    <li>Once approved, you can start creating tutoring sessions</li>
                </ul>
            </div>

            <form id="tutorApplicationForm">
                <div class="form-group">
                    <label for="yearsExperience">
                        Years of Tutoring Experience <span class="required">*</span>
                    </label>
                    <input
                        type="number"
                        id="yearsExperience"
                        name="yearsExperience"
                        min="0"
                        max="50"
                        step="1"
                        required
                        placeholder="e.g., 2"
                    />
                    <small>Include any informal tutoring experience (helping classmates, study groups, etc.)</small>
                </div>

                <!--
                <div class="form-group">
                    <label for="hourlyRate">
                        Hourly Rate (USD) <span class="required">*</span>
                    </label>
                    <input
                        type="number"
                        id="hourlyRate"
                        name="hourlyRate"
                        min="0"
                        max="999999.99"
                        step="0.01"
                        required
                        placeholder="e.g., 25.00"
                    />
                    <small>Set your hourly tutoring rate in dollars</small>
                </div>
                -->

                <div class="form-group">
                    <label for="description">
                        Short Description <span class="required">*</span>
                    </label>
                    <input
                        type="text"
                        id="description"
                        name="description"
                        maxlength="100"
                        required
                        placeholder="e.g., Computer Science major specializing in algorithms and data structures"
                    />
                    <small>A brief headline about your tutoring (max 100 characters)</small>
                </div>

                <div class="form-group">
                    <label for="bio">
                        Full Bio <span class="required">*</span>
                    </label>
                    <textarea
                        id="bio"
                        name="bio"
                        required
                        placeholder="Tell us about your academic background, teaching philosophy, areas of expertise, and what makes you a great tutor..."
                    ></textarea>
                    <small>Share your qualifications, experience, and teaching approach</small>
                </div>

                <div class="form-group">
                    <label for="resume">
                        Upload Resume/CV (Optional)
                    </label>
                    <div class="file-upload-container">
                        <label for="resume" class="file-upload-label">
                            Choose File
                        </label>
                        <input
                            type="file"
                            id="resume"
                            name="resume"
                            class="file-upload-input"
                            accept=".pdf,.doc,.docx"
                        />
                        <span class="file-name" id="fileName">No file chosen</span>
                    </div>
                    <small>Upload your resume in PDF or Word format (file upload coming soon)</small>
                </div>

                <div class="form-actions">
                    <a href="studentDashboard.html" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </div>
            </form>
        </div>
    </main>

    <div id="toast" class="toast"></div>

    <script>
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            void toast.offsetWidth;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // File upload display
        const fileInput = document.getElementById('resume');
        const fileNameDisplay = document.getElementById('fileName');

        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'No file chosen';
            }
        });

        // Redirect tutors to their dashboard - they don't need this page
        async function checkUserRoleAndRedirect() {
            try {
                const response = await fetch('/api/auth/me', {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success && data.user && data.user.role === 'Tutor') {
                    window.location.href = 'tutorDashboard.html';
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error checking user role:', error);
                return false;
            }
        }

        // Check if user already has an application
        async function checkApplicationStatus() {
            // First check if user is already a tutor
            const isTutor = await checkUserRoleAndRedirect();
            if (isTutor) return;

            try {
                const response = await fetch('/api/tutor/application-status', {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success && data.hasApplication) {
                    const form = document.getElementById('tutorApplicationForm');
                    const infoBox = document.querySelector('.info-box');

                    if (data.status === 'pending') {
                        form.style.display = 'none';
                        infoBox.innerHTML = `
                            <h3>Application Pending</h3>
                            <p>Your tutor application is currently under review. You will be notified once a decision has been made.</p>
                        `;
                        infoBox.style.borderLeftColor = '#f59e0b';
                        infoBox.style.backgroundColor = '#fef3c7';
                    } else if (data.status === 'rejected') {
                        infoBox.innerHTML = `
                            <h3>Application Previously Rejected</h3>
                            <p>Your previous application was not approved. You may submit a new application with updated information.</p>
                        `;
                        infoBox.style.borderLeftColor = '#ef4444';
                        infoBox.style.backgroundColor = '#fee2e2';
                    }
                }
            } catch (error) {
                console.error('Error checking application status:', error);
            }
        }

        // Check status on page load
        checkApplicationStatus();

        // Form submission
        const form = document.getElementById('tutorApplicationForm');
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Submitting...';
            submitButton.disabled = true;

            const applicationData = {
                yearsExperience: parseInt(document.getElementById('yearsExperience').value),
                //hourlyRate: parseFloat(document.getElementById('hourlyRate').value),
                description: document.getElementById('description').value.trim(),
                bio: document.getElementById('bio').value.trim()
            };

            try {
                const response = await fetch('/api/tutor/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(applicationData)
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Application submitted successfully! Redirecting...', 'success');
                    setTimeout(() => {
                        window.location.href = 'studentDashboard.html';
                    }, 1500);
                } else {
                    showToast(data.message || 'Failed to submit application. Please try again.', 'error');
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                }
            } catch (error) {
                console.error('Error submitting application:', error);
                showToast('An error occurred while submitting your application. Please try again.', 'error');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        });
    </script>

    <!-- Auth utility for managing login state and nav bar -->
    <script src="js/auth.js"></script>
</body>
</html>
